<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>스킬 계산기</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #121212;
      color: #ffffff;
      padding: 20px;
    }
    h2 {
      border-bottom: 1px solid #555;
      padding-bottom: 5px;
    }
    .section {
      margin-bottom: 30px;
    }
    label, input {
      display: block;
      margin: 5px 0;
    }
    input {
      width: 200px;
    }
    button {
      margin-top: 10px;
      padding: 10px;
      background: #333;
      color: #fff;
      border: none;
      cursor: pointer;
    }
    .result {
      margin-top: 10px;
      font-weight: bold;
      color: #00ff00;
    }
  </style>
</head>
<body>
  <h1>스킬 계산기</h1>

  <div class="section">
    <h2>공통 입력</h2>
    <label>기초 공격력: <input type="number" id="baseAtk"></label>
    <label>깡 공격력: <input type="number" id="flatAtk"></label>
    <label>공격력%: <input type="number" id="atkPercent"></label>
    <label>기초 스킬 데미지 (계수): <input type="number" id="baseSkill"></label>
    <label>추가 스킬 데미지 (계수): <input type="number" id="bonusSkill"></label>
    <label>치명타 확률%: <input type="number" id="critRate"></label>
    <label>치명타 피해%: <input type="number" id="critDmg"></label>
    <label>저주%: <input type="number" id="curse"></label>
    <label>감전%: <input type="number" id="shock"></label>
    <label>추가 피해%: <input type="number" id="bonusDmg"></label>
    <label>적중시 피해: <input type="text" id="onHitDmg" placeholder="예: 100 또는 10%"></label>
    <label>낙인 있음: <input type="checkbox" id="brand"></label>
    <label>기본 기술 피해량 증가%: <input type="number" id="basicSkillBonus"></label>
    <label>출혈 데미지%: <input type="number" id="bleedDmg"></label>
    <label>출혈 내성%: <input type="number" id="bleedResist"></label>
    <label>출혈 중첩: <input type="number" id="bleedStack"></label>
    <label>자상 데미지 (예: 10 또는 20%): <input type="text" id="stabDmg"></label>
    <label>숨겨진 칼날 유물 있음: <input type="checkbox" id="hiddenKnife"></label>
  </div>

  <div class="section">
    <button onclick="calculate()">계산하기</button>
    <div class="result" id="displayAtk"></div>
    <div class="result" id="displaySkill"></div>
    <div class="result" id="displayBasicSkill"></div>
    <div class="result" id="displayBleed"></div>
    <div class="result" id="displayStab"></div>
  </div>

  <script>
    function parsePercentOrValue(input) {
      if (!input) return 0;
      input = input.trim();
      if (input.endsWith('%')) {
        return parseFloat(input.replace('%', '')) / 100;
      }
      return parseFloat(input) || 0;
    }

    function calculate() {
      const get = id => document.getElementById(id).value;
      const getNum = id => parseFloat(get(id)) || 0;
      const checked = id => document.getElementById(id).checked;

      const baseAtk = getNum('baseAtk');
      const flatAtk = getNum('flatAtk');
      const atkPercent = getNum('atkPercent') / 100;
      const baseSkill = getNum('baseSkill');
      const bonusSkill = getNum('bonusSkill');
      const critRate = Math.min(getNum('critRate'), 100) / 100;
      const extraCrit = Math.max(getNum('critRate') - 100, 0) / 100;
      const critDmg = getNum('critDmg') / 100;
      const curse = getNum('curse') / 100;
      const shock = getNum('shock') / 100;
      const bonusDmg = getNum('bonusDmg') / 100;
      const onHitDmgRaw = get('onHitDmg');
      const brand = checked('brand') ? 1.2 : 1;
      const basicSkillBonus = getNum('basicSkillBonus') / 100;
      const bleedDmg = getNum('bleedDmg') / 100;
      const bleedResist = getNum('bleedResist') / 100;
      const bleedStack = getNum('bleedStack');
      const stabDmgRaw = get('stabDmg');
      const hiddenKnife = checked('hiddenKnife');

      const finalCrit = hiddenKnife ? Math.min(1 + extraCrit, 2) : critRate;

      const attackPower = (baseAtk + flatAtk) * (1 + atkPercent);
      const skillMultiplier = (baseSkill + bonusSkill);

      let onHitDmg = 0;
      if (onHitDmgRaw.includes('%')) {
        onHitDmg = attackPower * parsePercentOrValue(onHitDmgRaw);
      } else {
        onHitDmg = parseFloat(onHitDmgRaw) || 0;
      }

      let stabMultiplier = 1;
      if (stabDmgRaw.includes('%')) {
        stabMultiplier = 1 + parsePercentOrValue(stabDmgRaw);
      } else if (stabDmgRaw) {
        stabMultiplier = parseFloat(stabDmgRaw);
      }

      const displayAtk = attackPower.toFixed(2);

      const skillDmg = attackPower * skillMultiplier * finalCrit * (2 + critDmg) * brand * (1 + curse) * (1 + shock) * (1 + bonusDmg) + onHitDmg;
      const basicSkillDmg = attackPower * skillMultiplier * finalCrit * (2 + critDmg) * (1 + basicSkillBonus) * brand * (1 + curse) * (1 + shock) * (1 + bonusDmg) + onHitDmg;
      const bleedDmgResult = attackPower * 0.15 * (1 + bleedDmg) * (1 + bleedResist);
      const stabDmg = bleedDmgResult * bleedStack * 3.5 * stabMultiplier;

      document.getElementById('displayAtk').innerText = `표기 공격력: ${displayAtk}`;
      document.getElementById('displaySkill').innerText = `스킬 피해: ${skillDmg.toFixed(2)}`;
      document.getElementById('displayBasicSkill').innerText = `기본 기술 피해: ${basicSkillDmg.toFixed(2)}`;
      document.getElementById('displayBleed').innerText = `출혈 피해: ${bleedDmgResult.toFixed(2)}`;
      document.getElementById('displayStab').innerText = `자상 피해: ${stabDmg.toFixed(2)}`;
    }
  </script>
</body>
</html>
