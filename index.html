<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>스킬 계산기</title>
  <style>
    body {
      background-color: #121212;
      color: #e0e0e0;
      font-family: 'Segoe UI', sans-serif;
      padding: 20px;
    }
    input[type="text"], input[type="number"] {
      background-color: #1e1e1e;
      color: #fff;
      border: 1px solid #555;
      padding: 5px;
      margin: 3px 0;
      width: 150px;
    }
    label {
      display: block;
      margin-top: 10px;
    }
    button {
      margin-top: 15px;
      padding: 10px;
      background-color: #333;
      color: white;
      border: none;
      cursor: pointer;
    }
    #skillResult, #efficiencyResult {
      white-space: pre-line;
      margin-top: 20px;
      padding: 10px;
      background-color: #1e1e1e;
      border: 1px solid #444;
    }
  </style>
</head>
<body>
  <h2>스킬 계산기</h2>

  <label>기초 공격력: <input type="number" id="baseAtk"></label>
  <label>깡 공격력: <input type="number" id="flatAtk"></label>
  <label>공격력 %: <input type="text" id="atkPercent"></label>
  <label>기초 스킬 데미지 계수: <input type="number" id="baseSkillDmg"></label>
  <label>추가 스킬 데미지 계수: <input type="number" id="addSkillDmg"></label>
  <label>치명타 확률 %: <input type="text" id="critRate"></label>
  <label>치명타 피해 %: <input type="text" id="critDmg"></label>
  <label>저주 %: <input type="text" id="curse"></label>
  <label>감전 %: <input type="text" id="shock"></label>
  <label>추가 피해 %: <input type="text" id="addDmg"></label>
  <label>기본 기술 피해량 증가 %: <input type="text" id="basicBoost"></label>
  <label>적중시 피해 (상수 또는 %): <input type="text" id="hitDmg"></label>
  <label><input type="checkbox" id="markCheck"> 낙인 있음 (1.2배)</label>
  <label><input type="checkbox" id="hiddenBlade"> 숨겨진 칼날 유물 장착</label>

  <button onclick="calculateSkill()">계산하기</button>
  <div id="skillResult"></div>

  <h2>효율 계산기</h2>
  <label>현재 값: <input type="text" id="currentValue"></label>
  <label>추가되는 값: <input type="text" id="addedValue"></label>
  <button onclick="calculateEfficiency()">효율 계산</button>
  <div id="efficiencyResult"></div>

  <script>
    function parseValue(value) {
      if (!value) return 0;
      if (value.toString().includes('%')) {
        return parseFloat(value) / 100;
      }
      return parseFloat(value);
    }

    function calculateSkill() {
      const baseAtk = parseValue(document.getElementById('baseAtk').value);
      const flatAtk = parseValue(document.getElementById('flatAtk').value);
      const atkPercent = parseValue(document.getElementById('atkPercent').value);
      const baseSkillDmg = parseValue(document.getElementById('baseSkillDmg').value);
      const addSkillDmg = parseValue(document.getElementById('addSkillDmg').value);
      let critRate = parseValue(document.getElementById('critRate').value);
      let critDmg = parseValue(document.getElementById('critDmg').value);
      const curse = parseValue(document.getElementById('curse').value);
      const shock = parseValue(document.getElementById('shock').value);
      const addDmg = parseValue(document.getElementById('addDmg').value);
      const basicBoost = parseValue(document.getElementById('basicBoost').value);
      const hitDmgRaw = document.getElementById('hitDmg').value;
      const mark = document.getElementById('markCheck').checked;
      const hiddenBlade = document.getElementById('hiddenBlade').checked;

      const markValue = mark ? 1.2 : 1;

      let displayedCritRate = critRate;
      if (hiddenBlade) {
        displayedCritRate *= 1.5;
      }
      const critRateCapped = Math.min(displayedCritRate, 1);
      const overCritRate = Math.max(0, displayedCritRate - 1);

      const bonusCritDmgFromOver = hiddenBlade ? overCritRate : 0;
      const totalCritDmg = critDmg + bonusCritDmgFromOver;

      const displayedAtk = (baseAtk + flatAtk) * (1 + atkPercent);
      const totalSkillDmg = baseSkillDmg + addSkillDmg;

      const critMultiplier = (1 + critRateCapped) * (2 + totalCritDmg);
      let mainDamage = displayedAtk * totalSkillDmg * critMultiplier;
      mainDamage *= markValue * (1 + curse) * (1 + shock) * (1 + addDmg);

      const hitDmg = hitDmgRaw.includes('%') ? mainDamage * parseValue(hitDmgRaw) : parseFloat(hitDmgRaw) || 0;
      const totalDmg = mainDamage + hitDmg;
      const baseSkillDmgCalc = totalDmg * (1 + basicBoost);

      let formulaText = `표기 공격력 = (${baseAtk} + ${flatAtk}) × (1 + ${atkPercent * 100}%) = ${displayedAtk.toFixed(2)}\n`;
      formulaText += `치명타 확률 = ${critRate * 100}% ${hiddenBlade ? '× 1.5 = ' + (displayedCritRate * 100).toFixed(2) + '%' : ''}\n`;
      formulaText += `실제 적용 치확 = ${(critRateCapped * 100).toFixed(2)}%, 초과 치확 = ${(overCritRate * 100).toFixed(2)}%\n`;
      formulaText += `치명타 피해 = ${critDmg * 100}% ${bonusCritDmgFromOver > 0 ? `+ 초과치 ${bonusCritDmgFromOver * 100}%` : ''} = ${(totalCritDmg * 100).toFixed(2)}%\n`;
      formulaText += `스킬 피해 = [${displayedAtk.toFixed(2)} × (${baseSkillDmg} + ${addSkillDmg}) × (1 + ${critRateCapped * 100}%) × (2 + ${(totalCritDmg * 100).toFixed(2)}%)] × ${markValue} × (1 + ${curse * 100}%) × (1 + ${shock * 100}%) × (1 + ${addDmg * 100}%) + 적중시 피해 ${hitDmg.toFixed(2)}\n`;
      formulaText += `기본 기술 피해 = 위 총합 × (1 + 기본 기술 피해량 증가%) = ${baseSkillDmgCalc.toFixed(2)}\n`;

      document.getElementById('skillResult').textContent = `기본 기술 피해: ${baseSkillDmgCalc.toFixed(2)}\n\n` + formulaText;
    }

    function calculateEfficiency() {
      const currentValue = parseValue(document.getElementById('currentValue').value);
      const addedValue = parseValue(document.getElementById('addedValue').value);
      if (currentValue === 0) {
        document.getElementById('efficiencyResult').textContent = '현재 값이 0입니다.';
        return;
      }
      const efficiency = addedValue / currentValue;
      document.getElementById('efficiencyResult').textContent = `효율: ${(efficiency * 100).toFixed(2)}%`;
    }
  </script>
</body>
</html>
