<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>스킬 계산기</title>
  <style>
    body { font-family: sans-serif; padding: 20px; max-width: 900px; margin: auto; background: #f7f7f7; }
    h1 { text-align: center; }
    label { display: block; margin-top: 10px; font-weight: bold; }
    input[type="text"], input[type="number"] { width: 200px; padding: 5px; margin-top: 5px; }
    .section { border: 1px solid #ccc; padding: 15px; margin-top: 20px; background: #fff; border-radius: 10px; }
    .result { font-size: 1.2em; margin-top: 10px; }
    .switch { margin-top: 10px; }
    button { padding: 10px 20px; margin-top: 15px; }
  </style>
</head>
<body>
  <h1>스킬 계산기</h1>

  <div class="section">
    <h2>입력값</h2>
    <label>기초 공격력: <input type="number" id="baseAtk" /></label>
    <label>깡 공격력: <input type="number" id="flatAtk" /></label>
    <label>공격력%: <input type="text" id="atkPercent" /></label>
    <label>기초 스킬 데미지 계수: <input type="number" id="baseSkill" /></label>
    <label>추가 스킬 데미지 계수: <input type="number" id="bonusSkill" /></label>
    <label>치명타 확률%: <input type="text" id="critRate" /></label>
    <label>치명타 피해%: <input type="text" id="critDmg" /></label>
    <label>저주%: <input type="text" id="curse" /></label>
    <label>감전%: <input type="text" id="shock" /></label>
    <label>추가 피해%: <input type="text" id="extraDmg" /></label>
    <label>적중 시 피해: <input type="text" id="onHit" /></label>
    <label>기본 기술 피해량 증가%: <input type="text" id="basicSkillBoost" /></label>
    <label>출혈 데미지%: <input type="text" id="bleedDmg" /></label>
    <label>출혈 내성%: <input type="text" id="bleedResist" /></label>
    <label>출혈 중첩 수: <input type="number" id="bleedStack" /></label>
    <label>자상 데미지: <input type="text" id="stabDmg" /></label>

    <div class="switch">
      <label><input type="checkbox" id="brand"> 낙인 있음 (1.2배)</label>
      <label><input type="checkbox" id="hiddenBlade"> 숨겨진 칼날 유물 있음</label>
    </div>
  </div>

  <div class="section">
    <h2>계산 결과</h2>
    <button onclick="calculate()">계산하기</button>
    <div class="result" id="result"></div>
  </div>

  <script>
    function parsePercentOrConst(value) {
      if (!value) return null;
      value = value.trim();
      if (value.endsWith("%")) {
        return 1 + parseFloat(value) / 100;
      }
      return parseFloat(value);
    }

    function calculate() {
      const baseAtk = parseFloat(document.getElementById("baseAtk").value) || 0;
      const flatAtk = parseFloat(document.getElementById("flatAtk").value) || 0;
      const atkPercent = parsePercentOrConst(document.getElementById("atkPercent").value);
      const skillBase = parseFloat(document.getElementById("baseSkill").value) || 0;
      const skillBonus = parseFloat(document.getElementById("bonusSkill").value) || 0;
      const critRateRaw = parseFloat(document.getElementById("critRate").value) || 0;
      const critDmg = parsePercentOrConst(document.getElementById("critDmg").value);
      const curse = parsePercentOrConst(document.getElementById("curse").value);
      const shock = parsePercentOrConst(document.getElementById("shock").value);
      const extraDmg = parsePercentOrConst(document.getElementById("extraDmg").value);
      const onHit = parsePercentOrConst(document.getElementById("onHit").value);
      const basicSkillBoost = parsePercentOrConst(document.getElementById("basicSkillBoost").value);
      const bleedDmg = parsePercentOrConst(document.getElementById("bleedDmg").value);
      const bleedResist = parsePercentOrConst(document.getElementById("bleedResist").value);
      const bleedStack = parseFloat(document.getElementById("bleedStack").value) || 0;
      const stabDmgRaw = document.getElementById("stabDmg").value;
      const stabDmg = stabDmgRaw.endsWith("%") ? 1 + parseFloat(stabDmgRaw) / 100 : parseFloat(stabDmgRaw);
      const hasBrand = document.getElementById("brand").checked;
      const hasHiddenBlade = document.getElementById("hiddenBlade").checked;

      const totalAtk = (baseAtk + flatAtk) * (atkPercent || 1);

      let critRate = critRateRaw;
      if (critRate > 100) {
        critRate = hasHiddenBlade ? critRate / 100 : 1;
      } else {
        critRate = critRate / 100;
      }

      const critMulti = (1 + critRate) * (2 + ((critDmg || 0) - 1));
      const skillCoef = (skillBase + skillBonus);
      const brand = hasBrand ? 1.2 : 1;

      const curseVal = curse || 1;
      const shockVal = shock || 1;
      const extraVal = extraDmg || 1;
      const hit = onHit || 0;

      const skillDmg = totalAtk * skillCoef * critMulti * brand * curseVal * shockVal * extraVal + hit;
      const basicSkillDmg = totalAtk * skillCoef * critMulti * (basicSkillBoost || 1) * brand * curseVal * shockVal * extraVal + hit;
      const bleed = totalAtk * 0.15 * (bleedDmg || 1) * (bleedResist || 1);
      const stab = bleed * bleedStack * 3.5 * (stabDmg || 1);

      const display = `
        <strong>표기 공격력:</strong> ${totalAtk.toFixed(2)}<br/>
        <strong>스킬 피해:</strong> ${skillDmg.toFixed(2)}<br/>
        <strong>기본 기술 피해:</strong> ${basicSkillDmg.toFixed(2)}<br/>
        <strong>출혈 피해:</strong> ${bleed.toFixed(2)}<br/>
        <strong>자상 피해:</strong> ${stab.toFixed(2)}<br/>
      `;

      document.getElementById("result").innerHTML = display;
    }
  </script>
</body>
</html>
